<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Lingfeng Li">
<meta name="dcterms.date" content="2025-08-14">

<title>Causal Replication and Reppraisal of Tellez (2022) – Kevin Lingfeng Li</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="mathjax-config.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="paper.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Causal Replication and Reppraisal of Tellez (2022)</h1>
<p class="subtitle lead">‘Land, Opportunism, and Displacement in Civil Wars: Evidence from Colombia’</p>
</div>


<div class="quarto-title-meta-author column-page-left">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Kevin Lingfeng Li </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            London School of Economics
          </p>
      </div>
  </div>

<div class="quarto-title-meta column-page-left">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 14, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract">Abstract</h2>
<p>This paper was created for the summative assignment of the course: MY457 Causal Inference for Experimental and Observational Studies (2024-2025 Winter Term). This paper is a replication and reappraisal of the following paper:</p>
<blockquote class="blockquote">
<p>Tellez, J. F., (2022) ‘Land, opportunism, and displacement in civil wars: Evidence from Colombia’.&nbsp;<em>American Political Science Review,</em>&nbsp;116(2), pp.403-418.</p>
</blockquote>
<p>Replication code and data can be accessed at:</p>
<p><a href="https://github.com/kevinli03/kevinli03.github.io/tree/main/papers/my457" class="uri">https://github.com/kevinli03/kevinli03.github.io/tree/main/papers/gv482</a></p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this paper, I reappraise Tellez (2022)’s paper on displacement in civil wars in Colombia. First, I introduce the research design that the author employs, and the assumptions needed for causal identification. Then, I reproduce the main results of the paper.</p>
<p>After reproducing the paper, I critically evaluate the research design of Tellez (2022). First, I test and discuss issues regarding the identification assumptions and research design. Then, I discuss the limitations of the two-way fixed effects estimator, and test if the results of the paper are robust under modern difference-in-differences estimators and different specifications of the outcome variable.</p>
</section>
<section id="empirical-strategy" class="level1">
<h1>Empirical Strategy</h1>
<p>Tellez (2022) explores how displacement of civilians occurs during civil wars. More specifically, Tellez focuses on how the opportunity for local actors to expand profitable African Palm-oil plantations results in displacement of local civilians in war-torn areas of Colombia.</p>
<p>The main analysis of the paper is at the municipal level. Tellez compiles a panel dataset of different municipalities in Colombia over a time period of 1993-2005. His main treatment variable is if a municipality has at least 1 African Palm-oil plantation in a specific year, and his outcome variable is the civilian displacement rate per 1000 in a municipality in a specific year. The outcome variable has an inverse-sine transformation applied to it.</p>
<p>During this period, African Palm-oil is rapidly expanding in Colombia, so many, but not all municipalities receive their first African Palm-oil plantation during this time period. This variation across municipalities in adopting the treatment, and the variation in timing of the adoption of treatment, allows Tellez to conduct a difference-in-differences design, exploiting variation over the two dimensions of municipalities and time.</p>
<p>A difference-in-differences design has 3 identification assumptions, which I will introduce now, and evaluate later. The first assumption is parallel trends: if a treated unit had hypothetically not been treated, they would have followed the same trend in the outcome variable as the untreated units. In the context of this study, parallel trends asserts that if a municipality that had a palm-oil plantation hypothetically did not have a palm-oil plantation, the trend in displacement rate of civilians would be the same as the municipalities who did not have a palm-oil plantation.</p>
<p>Tellez (2022) believes “time-varying behaviour of guerrilla groups” and “changes in the drug trade” might result in a violation of the parallel trends assumption. Thus, the author asserts that parallel trends is conditional on two covariates: the presence of coca production, and the amount of left-wing guerrilla attacks in a municipality in a specific year.</p>
<p>The second identification assumption is no anticipation: in the pre-treatment period(s), the observed outcome is equal to the potential outcome under control. In the context of this paper, no anticipation means that the displacement rate of a country in a pre-treatment year is not affected by the anticipation of palm-oil plantations in the future, before the palm-oil plantations have been established in that municipality. Tellez does not justify that he meets this assumption in his paper.</p>
<p>The final assumption for difference-in-differences is the stable unit treatment value assumption (SUTVA): that one unit’s treatment status does not affect the potential outcomes of another unit. In the context of this paper, one municipality getting (or not getting) a palm-oil plantation does not affect the displacement rate of other municipalities. SUTVA also states that treatments are consistent/identical across observations. Tellez does not justify meeting this assumption.</p>
<p>Under these three identification assumptions, the average treatment effect on the treated is identified. I will further explore and evaluate these identification assumptions later.</p>
</section>
<section id="replication" class="level1">
<h1>Replication</h1>
<p>To estimate the causal effects, Tellez (2022) employs the two-way fixed effects estimator. Under the assumption of parallel trends, fixed effects for municipalities (unit) and years (time) should make treatment exogenous, allowing for the estimation of treatment effects. I will further discuss this choice of estimator later.</p>
<p>The author conducts 4 different two-way fixed effects models in his analysis. His first model contains relevant covariates to meet conditional parallel trends:</p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \gamma_t + D_{it}\tau + \pmb X_{it}^\top\pmb{\beta} + \varepsilon_{it}
\]</span></p>
<p>Where <span class="math inline">\(Y_{it}\)</span> is the displacement rate in a municipality (with inverse-sine transformation) in municipality <span class="math inline">\(i\)</span> in year <span class="math inline">\(t\)</span>, <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\gamma_t\)</span> are municipality and year fixed effects, <span class="math inline">\(D_{it}\)</span> is a binary indicator that indicates the presence of a palm-oil plantation, and <span class="math inline">\(\mathbf X_{it}\)</span> is a vector of covariates to condition for parallel trends.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Tellez’s second, third, and fourth models involves an interaction with the treatment variable to explore heterogeneous effects:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><span class="math display">\[
Y_{it}= \alpha_i + \gamma_t + D_{it}\tau  + D_{it}G_{it}\theta + \pmb X_{it}^\top\pmb\beta + \varepsilon_{it}
\]</span></p>
<ul>
<li>In the second model, <span class="math inline">\(G_{it}\)</span> is the amount of palm planted each year (logged) to explore heterogeneity based on intensity of palm-oil production.</li>
<li>In the third model, <span class="math inline">\(G_{it}\)</span> is an indicator for the presence of the AUC, an allied paramilitary group to many local landlords and actors.</li>
<li>In the fourth model, <span class="math inline">\(G_{it}\)</span> is an indicator for the presence of FARC, a left-wing paramilitary group that generally opposes landowners and is less likely to collaborate with local elites.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ul>
<p>The reproduced results of all four models are provided in table 1. For replication, I chose to use the more modern and faster <em>fixest</em> package, rather than the older <em>felm</em> package. The replication results are identical to those presented in the paper.</p>
<p>There is one slight concern with model 4 in the original paper: the author fails to include one of the covariates, FARC-attacks, which was included in all the other models.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> This choice of omission was likely intentional, as this control is very similar to the dummy FARC presence interaction variable. However, the paper does not explain or acknowledge dropping this control variable for model 4. For completeness, I have included an additional model 4*, which includes this control variable.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Tellez (2022) also runs an estimation of dynamic treatment effects using the Sun and Abraham (2021) estimator. For unclear reasons, Tellez only includes these results in the appendix, but because dynamic treatment effects are useful for both visualising treatment effects over time, as well as assessing the parallel trends assumption, I have (successfully) replicated the results in figure 1.</p>
<p>Tellez (2022) later runs an analysis on how the treatment, palm oil plantations, correlates with modern claims of “land restitution”. However, this analysis is not causal - Tellez himself states “these results cannot be interpreted causally” (Tellez 2022, p.&nbsp;411). Tellez also runs an household analysis, which he comments that “the causal interpretation of these estimates is limited”. Thus, I do not consider this analysis to be a core part of the paper’s causal analysis. I provide the replication in the appendix.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluation-of-assumptions" class="level1">
<h1>Evaluation of Assumptions</h1>
<section id="parallel-trends-assumption" class="level2">
<h2 class="anchored" data-anchor-id="parallel-trends-assumption">Parallel Trends Assumption</h2>
<p>The parallel trends assumption states if a treated unit had hypothetically not been treated, they would have followed the same trend in the outcome variable as the untreated units. In the context of this study, if a municipality that had a palm-oil plantation hypothetically did not have a palm-oil plantation, the trend in displacement rate of civilians would be the same as the municipalities who did not have a palm-oil plantation. Tellez (2022) asserts that parallel trends in this study is conditional on two covariates: the presence of coca production, and the amount of left-wing guerrilla attacks in a municipality in a specific year.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>A conventional way to test the parallel trends assumption is with a leads-and-lags test. From the reproduced interaction-weighted (Sun and Abraham 2021) dynamic treatment effects in figure 1 above, we can see that there are no statistically significant estimates (at p&lt;0.05) in the pre-treatment period. Thus, this test provides insufficient evidence of a violation of parallel trends.</p>
<p>However, significance testing individual pre-treatment coefficients is not a sufficient approach to test for violations of parallel trends. We also have to consider the substantive size of the estimated deviations in the pre-treatment periods, as well as consider the joint significance of pre-treatment estimates (Liu et al, 2024).</p>
<p>Figure 2 contains two of these pre-trend tests using the fixed effects counterfactual (FEct) estimator proposed by Liu, Xu, and Wang (2024).<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> Imputation estimators like FEct generally have greater power in testing pre-trend deviations (Chiu et al 2025). FEct also allows the easy implementation of a joint-significance test (F-test) and a equivalence test (TOST) for substantive significance.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The joint significance F-test of the pre-treatment coefficients checks if there is a significant pre-treatment differential trend: statistical significance indicates there is a differential trend. For this study, the p-value is insignificant for the last 5 pre-treatment years, thus we do not find evidence of violating the parallel trends assumption with this test.</p>
<p>The equivalence test (TOST) for substantive size of estimated deviations checks if the confidence intervals of estimates in the pre-treatment trend exceed an “equivalence” range around 0. The equivalence range is defined as 0.36 times the standard deviation of the outcome variable, after partialling out unit and time fixed effects. A significant result means the pre-treatment estimates are within the equivalence range. For this study, the p-value is insignificant, indicating evidence for a potential violation in parallel trends.</p>
<p>Notably, it seems as the estimate in pre-treatment period -5 is abnormally high, while the others seem to be closer to 0. Since the pre-treatment period -5 is still 5 years before treatment, it may not be entirely relevant to the parallel trends between pre-treatment and post-treatment.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> Figure 3 re-runs the tests, this time only for 4 pre-treatment periods. The p-value for the F-test is higher, which is a good sign for meeting parallel trends. However, the study still fails the equivalence test.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A notable choice the authors make is that they transform the outcome variable, rate of civilian displacement, with an inverse-sine transformation. Their theoretical justification for including an inverse-sine transformation is that it can make the outcome more normally distributed and reduce outliers. However, transformations affect the parallel trends assumption. Figure 4 contains the same parallel trends tests on a non-transformed outcome variable.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Interestingly, the non-transformed outcome variable passes both tests for the parallel trends assumption in 4 pre-treatment years. If parallel trends is met on the non-transformed outcome, that implies that parallel trends cannot be met on the inverse-sine transformed outcome (and vice versa).</p>
<p>This may suggest that Tellez would have been better off dealing with a non-transformed outcome variable. However, we also have to be careful about conditioning our analysis based off of if we pass the parallel trends test, as this can bias our ATT estimates (Roth, 2020). Another concern is that without the inverse-sine transformation, outliers are more influential, which increases the standard deviation of the outcome variable, thus increasing the range of equivalence in our test.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>It is important to note that pre-trend tests for parallel trends are not entirely reliable. Pre-trend tests tend to have less power than our main treatment effect estimates (Roth, 2020). Furthermore, the parallel trend that is essential to difference-in-differences is that of the potential outcome under control for the last pre-treatment and into the post-treatment periods. Since this involves unobserved counterfactuals for the treated units, the pre-trend test does not directly test if the relevant parallel trends needed for identification is met.</p>
</section>
<section id="no-anticipation-and-sutva" class="level2">
<h2 class="anchored" data-anchor-id="no-anticipation-and-sutva">No Anticipation and SUTVA</h2>
<p>The no anticipation assumption states that in the pre-treatment period(s), the observed outcome is equal to the potential outcome under control. Or in the context of this paper, it means that the displacement rate of a country in a pre-treatment year is not affected by the anticipation of palm-oil plantations in the future, before the palm-oil plantations have been established in that municipality.</p>
<p>Tellez (2022) does not justify that he meets this assumption in his paper. I believe there are theoretical reasons to believe that this assumption is not met. It seems plausible that it takes time to set up the necessary infrastructure and equipment to begin running a palm-oil plantation. That could imply that the land acquisition took place a decent period of time before the actual palm-oil plantation began operation.</p>
<p>Recall that the causal theory of Tellez (2022) is regarding how land acquisition for palm-oil plantations drives displacement. If land acquisition occurs in the previous year before a palm-oil plantation began operation, it is plausible that the “true” treatment occurred in the year prior to the “recorded” treatment in the study. This would mean that the first pre-treatment period’s observed outcomes for treated units would not be their potential outcome under control, but rather the potential outcome under treatment, violating the no anticipation assumption. This could explain the noticable “jump” in difference between treated and untreated in pre-period -5, in both figures 1 and 2.</p>
<p>If anticipation is systematic, i.e.&nbsp;every treated municipality has the same length of pre-treatment anticipation, we could correct for it by changing the treatment variable to align with the anticipation period. However, adjusting for anticipation becomes more difficult if it varies between different municipalities. As I do not have enough theoretical expertise on the subject of palm-oil plantations in Colombia, it is hard for me to select a specific anticipation structure in which to adjust for.</p>
<p>There is also a completely opposite concern - that the opportunistic elites did not initiate land dispalcement until after palm-oil plantations were first established and proven to be profitable in a municipality. While I have no strong theoretical backing of this, the dynamic treatment effects from figure 1 (Sun and Abraham) seem to suggest the statistically significant causal results occurred in the 4th post-treatment period and onward. This could be considered more of a measurement problem - the choice of using the presence of the first palm-oil plantation as the treatment may not be properly approximating when local elites began to initiate forced displacement.</p>
<p>The stable unit treatment value assumption (SUTVA) states that one unit’s treatment status does not affect the potential outcomes of another unit. Or in the context of this paper, one municipality getting (or not getting) a palm-oil plantation does not affect the displacement rate of other municipalities. SUTVA also states that treatments are consistent/identical across observations.</p>
<p>Tellez (2022) does not justify meeting this assumption. I believe there are theoretical reasons to believe this assumption is not met. For example, take neighboring municipalities. If one municipality starts to build land-intensive palm-oil plantations, according to the theoretical causal mechanism, that will cause forced displacement of citizens in that first municipality. Neighboring municipalities will see that municipality have large displacement of civilians. It is plausible that some civilians in the nearby municipalities will also fear for their safety, and flee. It is also plausible that the coercive tactics used by local elites and allied armed groups to acquire land in one municipality would have effects on neighboring citizens.</p>
<p>If this theoretical story is true, that creates issues with our potential outcomes framework. In the normal framework, the potential outcomes <span class="math inline">\(Y_{it}(d)\)</span> only depend on unit <span class="math inline">\(i\)</span>’s own treatment status <span class="math inline">\(d\)</span>. However, if the story above is plausible, the potential outcomes of unit <span class="math inline">\(i\)</span> will now depend on not just unit <span class="math inline">\(i\)</span>’s treatment status, but also unit <span class="math inline">\(j\)</span>’s treatment status. This means our individual causal effect will no longer be <span class="math inline">\(\tau = Y_{it}(1) - Y_{it}(0)\)</span>, which will invalidate the identification proof behind difference-in-differences.</p>
<p>Furthermore, it is unlikely that the treatment of palm-oil plantations is stable/consistent/identical across units. After all, a series of massive palm-oil plantations in a municipality is very different than just one smaller palm-oil plantation. Tellez tries to address this in model (2) by interacting palm-oil production levels with treatment. However, Tellez only uses national aggregate palm-oil production data, which fails to capture the differences between municipalities, so this interaction is insufficient to deal with this issue.</p>
</section>
</section>
<section id="evaluation-of-estimation" class="level1">
<h1>Evaluation of Estimation</h1>
<p>Tellez (2022) primarily relies on the two-way fixed effects estimator for the main results of the paper. However, in staggered treatment settings with heterogeneous treatment effects, two-way fixed effects no longer is an unbiased estimator of the ATT (Goodman-Bacon 2021). This is because the two-way fixed effects makes incorrect comparisons involving already-treated units, and assigns weights in a manner where some comparisons have negative weights.</p>
<p>The difference-in-differences revolution post 2021 has introduced several new unbiased estimators of the ATT. Tellez (2022) only uses the Sun and Abraham (2021) estimator, and only includes it in the appendix as a check for parallel trends. I will implement several of these modern difference-in-differences estimators, and compare their overall ATT estimates with the results of model (1) from Tellez (2022). The results are shown in figure 5.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Interestingly, it seems the imputation/counterfactual based estimators (did2s, IFEct, ETWFE) produce significant results, while the matching and reweighting estimators (csdid, IW, DIDmultiple, PanelMatch) produce insignificant effects. The consequence of these results is hard to evaluate, as some estimators find significant effects, while others do not. Imputation/counterfactual estimators are generally more vulnerable to poor model specification - but if the models are specified correctly, they tend to perform better (Chiu et al 2025, Roth et al, 2022). Matching and reweighting methods are more robust to model mispecification, but rely more on the assumptions of Difference-in-differences. It is hard to say which case this study lies in - thus, these new results do not provide conclusive robustness or rejection of the result Tellez (2022) obtains.</p>
<p>As noted in the section on evaluating identification assumptions, it seems that the parallel trends assumption is violated with the inverse-sine transformed outcome. This also puts into question if the above results are valid (although some of the above estimators, such as IFEct, can be somewhat robust to minor violations in parallel trends). Thus, in figure 6, I also implement the same estimators, but with the non-transformed outcome variable.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>More of the estimators find a significant causal effect when the outcome variable is not transformed. However, there are two reasons we should be cautious about these results. First, conditioning our analysis based off of if we pass the parallel trends test can bias our ATT estimates (Roth, 2020). Second, without the inverse-sine transformations, outliers are more influential, which may impact our results.</p>
<p>Overall, there is not enough evidence to conclusively support or reject the findings of Tellez (2022). Most new estimators provide similar point estimates to that of the two-way fixed effects estimator. However, in both the transformed and non-transformed outcome models, there are multiple estimators that do not find a significant causal result.</p>
<p>Tellez also runs other models with interactions. One way to test the robustness of these models under modern estimators is to use the 2-stage difference-in-differences estimator (did2s) proposed by Gardner (2021). Gardner does not explicitly state that interactions for heterogeneity are accommodated in the estimator, but we can show it is possible. The estimator first models the potential outcome <span class="math inline">\(Y_{it}(0)\)</span> by estimating the following regression with only untreated <span class="math inline">\(D_{it} = 0\)</span> units:</p>
<p><span class="math display">\[
Y_{it}(0) = \alpha_i + \gamma_t + \pmb X_{it}^\top \pmb\beta + \varepsilon_{it} \quad \text{estimate with only units }D_{it} = 0
\]</span></p>
<p>Then, using the estimates of <span class="math inline">\(\hat\alpha_i\)</span>, <span class="math inline">\(\hat\gamma_t\)</span>, and <span class="math inline">\(\hat{\pmb\beta}\)</span>, we can estimate <span class="math inline">\(Y_{it}(0)\)</span> for all units:</p>
<p><span class="math display">\[
\widehat Y_{it}(0) = \hat\alpha_i + \hat\gamma_t + \pmb X_{it}^\top \hat{\boldsymbol\beta}
\]</span></p>
<p>Then, for all units, we can calculate the <em>difference/residual</em>, defined as <span class="math inline">\(\Delta_{it} = Y_{it} - \widehat Y_{it}(0)\)</span>. For treated units <span class="math inline">\(D_{it} = 1\)</span>, <span class="math inline">\(\Delta_{it} \approx \tau_{it}\)</span>. For untreated units <span class="math inline">\(D_{it} = 0\)</span>, <span class="math inline">\(\Delta_{it} \approx 0\)</span>. Gardner’s 2nd stage is given by the following regression, where <span class="math inline">\(\delta \approx 0\)</span>.<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a></p>
<p><span class="math display">\[
\Delta_{it} = \delta + D_{it}\theta  + \epsilon_{it}
\]</span></p>
<p><span class="math inline">\(\hat\theta = \hat\tau_\text{ATE}\)</span> once estimated with OLS.<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> To estimate heterogenous treatment effects, we can include interactions in the final stage, obtaining the following regression model:</p>
<p><span class="math display">\[
\Delta_{it} = \delta + D_{it} \theta + D_{it}G_{it}\phi + \epsilon_{it}
\]</span></p>
<p>Assume <span class="math inline">\(G_{it}\)</span> is a binary variable for simplicity. We can then use the conditional expectation definition of regression. Since <span class="math inline">\(\delta \approx 0\)</span>, and for treated units <span class="math inline">\(\Delta = \tau\)</span>, we can deduce:</p>
<p><span class="math display">\[
\begin{split}
&amp; \mathbb E[\Delta_{it} | D_{it} = 1, G_{it} = 0] \quad = \theta \quad \approx   \mathbb E[\tau_{it} | D_{it} = 1, G_{it} = 0] \\
&amp; \mathbb E[\Delta_{it} | D_{it} = 1, G_{it} = 1] \quad = \theta + \phi \quad \approx \mathbb E[\tau_{it} | D_{it} = 1, G_{it} = 1]
\end{split}
\]</span></p>
<p>Thus, Gardner’s did2s can be used to uncover heterogeneous treatment effects with interactions, assuming <span class="math inline">\(\widehat Y_{it}(0)\)</span> is consistently estimated.<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> This allows us to check if the heterogeneity Tellez (2022) explores with interactions holds when adjusting for the limitations in two-way fixed effects. The results are shown in table 2.</p>
<p>&nbsp;</p>
<p>The Gardner (2021) estimates for models 3, 4, and 4* are relatively similar in magnitude to the original two-way fixed effects estimates. The notable difference is in model 4 and 4*, where the effect of a palm-oil plantation in municipalities without a FARC presence is now statistically significant. Model 3’s similarity in Gardner’s estimator provides robustness to the result Tellez (2022) finds.</p>
<p>The results of model 2 differ quite a lot between the two estimators. In Gardner’s estimator, national production now no longer significantly increases the causal effect of the presence of a palm-oil plantation. This does not support Tellez’s finding.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<section id="original-paper" class="level2">
<h2 class="anchored" data-anchor-id="original-paper">Original Paper</h2>
<p>Tellez, J. F., (2022) ‘Land, opportunism, and displacement in civil wars: Evidence from Colombia’. <em>American Political Science Review</em>, 116(2), pp.403-418.</p>
</section>
<section id="other-references" class="level2">
<h2 class="anchored" data-anchor-id="other-references">Other References</h2>
<p>Baker, A., Callaway, B., Cunningham, S., Goodman-Bacon, A., Sant’Anna, P. H. (2025) ‘Difference-in-Differences Designs: A Practitioner’s Guide’. Available at: <a href="https://doi.org/10.48550/arXiv.2503.13323" class="uri">https://doi.org/10.48550/arXiv.2503.13323</a>.</p>
<p>Callaway, B., and Sant’Anna, P. H. (2021) ‘Difference-in-differences with multiple time periods’, <em>Journal of Econometrics</em>, 225(2), pp.&nbsp;200-230.</p>
<p>de Chaisemartin, C., D’Haultfœuille, X., and Vazquez-Bare, G. (2024) ‘Difference-in-Difference Estimators with Continuous Treatments and No Stayers’, <em>American Economic Association Papers and Proceedings</em>, 114, pp.&nbsp;610-613.</p>
<p>Chiu, A., Lan, X., Liu, Z., Xu, Y. (2025) ‘Causal Panel Analysis under Parallel Trends: Lessons from a Large Reanalysis Study’. Available at: <a href="https://doi.org/10.48550/arXiv.2309.15983" class="uri">https://doi.org/10.48550/arXiv.2309.15983</a>.</p>
<p>Gardner, J. (2021) ‘Two-stage Difference-in-Differences’. Available at: <a href="https://jrgcmu.github.io/2sdd_current.pdf" class="uri">https://jrgcmu.github.io/2sdd_current.pdf</a>.</p>
<p>Goodman-Bacon, A. (2021) ‘Difference-in-Differences with variation in treatment timing’, <em>Journal of Econometrics</em>, 225(2), pp.&nbsp;254-277.</p>
<p>Imai, K., Kim, I. S., Wang, E. H. (2023) ‘Matching Methods for Causal Inference with Time-Series Cross-Sectional Data’, <em>American Journal of Political Science</em>, 67(3), pp.&nbsp;587-605.</p>
<p>Liu, L, Wang, Y., and Xu, Y. (2024) ‘A practical guide to counterfactual estimators with causal inference with time-series cross-sectional data’, <em>American Journal of Political Science</em>, 68(1), pp.&nbsp;160-176.</p>
<p>Roth, J., Sant’Anna, P. H., Bilinski, A., and Poe, J. (2023) ‘What’s trending in difference-in-differences? A synthesis of the recent econometrics literature’, <em>Journal of Econometrics</em>, 235(2), pp.&nbsp;2218-2244.</p>
<p>Roth, J. (2022) ‘Pretest with Caution: Event-Study Estimates after Testing for Parallel Trends’, <em>American Economic Review</em>: Insights, 4(3), pp.&nbsp;305-322.</p>
<p>Sun, L. and Abraham, S. (2021) ‘Estimating dynamic treatment effects in event studies with heterogenous treatment effects’, <em>Journal of Econometrics</em>, 225(2), pp.&nbsp;175-199.</p>
<p>Wooldridge, J. M. (2021) ‘Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Differences Estimators’. Available at: <a href="https://dx.doi.org/10.2139/ssrn.3906345" class="uri">https://dx.doi.org/10.2139/ssrn.3906345</a>.</p>
</section>
<section id="replication-data" class="level2">
<h2 class="anchored" data-anchor-id="replication-data">Replication Data</h2>
<p>Tellez, J. F. (2021) ’Replication Data for: Land, Opportunism, and Displacement in Civil Wars: Evidence from Colombia”, <em>Harvard Dataverse</em>. Available at: <a href="https://doi.org/10.7910/DVN/DG2J0F" class="uri">https://doi.org/10.7910/DVN/DG2J0F</a>.</p>
</section>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="paper_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The covariates included are the presence of coca production, and the amount of left-wing guerrilla attacks in a municipality in a specific year, as mentioned in the research design.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The variable interacted with treatment is not included separately in the regression.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Model 4 is actually mis-specified (at least based on how the author’s define it). Model 4* adjusts this error.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I noticed this discrepancy through the number of observations in each regression model. Note how model 4 has more observations than the other models - this shouldn’t be the case, especially considering model 4 in theory should have the same variables as model 1 + additional variables.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Including FARC-attacks as a control variable may not make much sense, since the goal of the interaction between plantation and FARC presence is to see how the presence of FARC alters the treatment. We are not really interested in holding FARC-attacks constant in this analysis.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>As mentioned above in research design, coca production is a covariate meant to control for “changes in the drug trade”, which implies that coca production (and druge trade) has some effect on the outcome of displacement. However, in the literature review (p.&nbsp;406), Tellez argues that “illegal crops” like coca that are grown on “small plots” tend to rarely effect displacement. This seems like a contradiction.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>I chose to use FEct instead of IFEct because IFEct’s inclusion of time-varying latent factors makes it more robust to parallel trends. However, the goal if this test is to see if parallel trends holds for most other estimators that rely on parallel trends without a latent factor.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>The parallel trends assumption requires that the potential outcomes are “parallel” in trend between treatment and control from the pre-treatment period to the post-treatment period. The 5th year before treatment is likely not important to parallel trends if the final 4 pre-treatment periods are parallel.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>The equivalence range is defined as 0.36 times the standard deviation of the outcome variable, after partialling out unit and time fixed effects. Outliers will increase the standard deviation of the outcome variable.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>The ATT is in terms of the inverse-sine transformed outcome variable. For csdid, the doubly-robust estimator is used. For PanelMatch, units are matched on treatment/outcome history for 3 lag periods, and matches are weighted by mahalanobis distance for covariates. Covariates are included for all except DIDmultiple.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p><span class="math inline">\(\delta \approx 0\)</span> because by the conditional expectation definition of regression, we can see <span class="math inline">\(\mathbb E[\Delta_{it}|D_{it} = 0] = \delta\)</span>, and <span class="math inline">\(\mathbb E[\Delta_{it}|D_{it} = 0] = \mathbb E[\tau_{it}|D_{it} = 0]\)</span> from above, thus <span class="math inline">\(\delta  = 0\)</span>.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>The proof for this is provided by Gardner (2022).<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>The proof for this is provided by Gardner (2022).<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>